README

=========================================================================================================
Instructions for using four-chamber mesh generation pipeline
=========================================================================================================

=========================================================================================================
Segmentation
=========================================================================================================
1) Make folder (e.g. henry) in /data/Dropbox then make folder “segmentations” inside
2) Copy “points.txt”, “labels.txt”, “origin_spacing.txt” and “origin_spacing_labels.txt” templates into "segmentations" folder (currently in “h_templates” folder)
3) Move end-diastolic image CT image into folder and call that directory "ct"
4) Move segmented CT into "segmentations" folder.
5) Manually split and relabel pulmonary veins:
6) Export the segmentation as “seg_corrected.nrrd” with the new tags:
        LSPV = 8
        LIPV = 9
        RSPV = 10
        RIPV = 11
        LAA = 12

conda deactivate
conda activate pyseg

7) Run “find_origin_and_spacing.py /heart_folder/segmentations”
8) Copy origin and spacing into respective “.txt” files

9) Select 3 points for SVC and IVC cylinders (pixel) and save in “points.txt”
10) Select 3 points for Ao_slicer and for PArt_slicer and save in “points.txt”
    a. Note: be careful not to crop the PArt too close to the RV_BP
11) Run “create_cylinders.py /heart_folder/segmentations”

12) Run “create_svc_ivc.py /heart_folder/segmentations”

13) Select seed points for SVC_tip and IVC_tip
    a. Note: tips are used for removing sections protruding from wrong side of RA
14) Select a seed point for the Ao_tip and PArt_tip
15) Select 3 points for SVC_slicer and IVC_slicer and save in “points.txt”
15b) Might need to create cylinders again now. 
16) Run “crop_svc_ivc.py /heart_folder/segmentations”

17) Run “create_myo.py /heart_folder/segmentations”

18) Select a seed point for the Ao_wall_tip and PArt_wall_tip
19) Run “create_valve_planes.py /heart_folder/segmentations”

20) Run “clean_seg.py /heart_folder/segmentations”

21) Load .nrrd and manually clean valve ring
22) Export segmentation as “seg_final.nrrd”

23) Run “segSmoothing.sh /heart_folder/segmentations”

=========================================================================================================
Meshing
=========================================================================================================
1) Run “meshing.py /heart_folder”

2) cd into the meshing folder (inside heart folder)
3) Run “bash generate_heart_mesh_Cesare.sh”

4) Run “bash mesh_post.sh /heart_folder” ## watch out mesh tool path currently hard-coded ##

=========================================================================================================
UVCs
=========================================================================================================
1) Run “bash surfaces_extraction_uvc.sh /heart_folder”
	a. Note: the base number in “pick apex” refers to the LA in the segmentation (104) so watch out for this step if segmentation labels change

2) Run “extract_bivmesh_uvc.sh /heart_folder” – watch out – scriptsPath hardcoded

3) Run “runUVC.sh /heart_folder”

4) Run “surfaces_extraction_fibres_la.sh /heart_folder”

5) Run “extract_la.sh /heart_folder”

6) Use “la.vtk” to select points for the la apex and la septum
7) Run “runUVC_la.sh /heart_folder”
 
8) Run “surfaces_extraction_fibres_ra.sh /heart_folder”

9) Run “extract_ra.sh /heart_folder”

10) Use “ra.vtk” to select points for the ra apex and ra septum 
11) Run “runUVC_ra.sh /heart_folder”

==========
Ventricular fibres
==========

==========
Atrial fibres
=========

=========
Pre-sim
=========













